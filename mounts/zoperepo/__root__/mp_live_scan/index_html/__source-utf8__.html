<p metal:use-macro="context/master_pt/macros/std_page">
    <div metal:fill-slot="std_body">

        <h1>Mediapipe Live Scan</h1>
        
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../index_html">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Mediapipe Live Scan</li>
          </ol>
        </nav>

        <button type="button" class="btn btn-success" onclick="start_tut(event)">
            <i class="fa-solid fa-graduation-cap"></i>
            Tutorial
        </button>

        <h4>Websocket connection</h4>
        <div class="input-group mb-3">
            <label class="input-group-text" for="ws_addr">Websocket address</label>
            <input id="ws_addr" type="text" class="form-control" aria-label="ws_addr" value="ws://192.168.178.130:4242" data-tour="step: 1; title: Websocket address; content: Enter full websocket address of websocket server here">
            <button class="btn btn-primary" id="connect_ws_btn" type="button" data-tour="step: 2; title: Connect websocket; content: Connect to websocket server here">
                <i class="fa-solid fa-link"></i>
                <span id="run_label">Connect websocket</span>
            </button>

            <button disabled class="btn btn-primary" id="broadcast_scan" type="button" data-tour="step: 30; title: Broadcast live scan; content: Broadcast live scan to websocket server. Click again to stop broadcast.">
                <i class="fa-solid fa-tower-broadcast"></i>
                <span id="broadcast_scan_label">Start broadcast</span>
            </button>

        </div>

        <span id="ws_not_connected" class="badge rounded-pill bg-warning text-dark mb-2" data-tour="step: 3; title: Websocket connection indicator; content: Indicates websocket connectivity">Not connected</span>
        <span id="ws_connected" style="display: none;" class="badge rounded-pill bg-success mb-2">Connected</span>

        <span id="bc_not_running" class="badge rounded-pill bg-warning text-dark mb-2" data-tour="step: 4; title: Broadcast indicator; content: Indicates wether broadcast is running">Broadcast inactive</span>
        <span id="bc_running" style="display: none;" class="badge rounded-pill bg-success mb-2">Broadcast active</span>

        <h4>Model control</h4>
        <div class="input-group mb-3">

            <label class="input-group-text" for="model_chooser">Model</label>
            <select class="form-select" id="model_chooser" data-tour="step: 5; title: Choose model; content: Choose between Full and Lite model for scan">
                <option value="full" selected>Full</option>
                <option value="lite">Lite</option>
            </select>

            <label class="input-group-text" for="numposes">Number of poses</label>
            <input id="numposes" type="text" class="form-control" aria-label="ws_addr" value="1" data-tour="step: 6; title: Number of poses; content: Number of poses to scan in webcam image">

            <label class="input-group-text" for="minPoseDetectionConfidence">minPoseDetectionConfidence</label>
            <input type="range" min="0" max="1" value="0.5" step="0.05" id="minPoseDetectionConfidence" data-tour="step: 7; title: minPoseDetectionConfidence [0..1]; content: The minimum confidence score for the pose detection to be considered successful">

            <label class="input-group-text" for="minPosePresenceConfidence">minPosePresenceConfidence</label>
            <input type="range" min="0" max="1" value="0.5" step="0.05" id="minPosePresenceConfidence" data-tour="step: 8; title: minPosePresenceConfidence [0..1]; content: The minimum confidence score of pose presence score in the pose landmark detection">

            <label class="input-group-text" for="minTrackingConfidence">minTrackingConfidence</label>
            <input type="range" min="0" max="1" value="0.5" step="0.05" id="minTrackingConfidence" data-tour="step: 9; title: minTrackingConfidence [0..1]; content: The minimum confidence score for the pose tracking to be considered successful">

            <button class="btn btn-primary" id="load_model" type="button" data-tour="step: 10; title: Load model; content: Load model to enable webcam scan.">
                <i class="fa-solid fa-play"></i>
                <span id="load_model_label">Load Model</span>
            </button>

        </div>

        <h4>Webcam control</h4>
        <div class="input-group mb-3">

            <label class="input-group-text" for="resx">Resolution X</label>
            <input id="resx" type="text" class="form-control" aria-label="ws_addr" value="1920" data-tour="step: 11; title: Resolution X; content: Adjust X-Axis Resolution of camera here">

            <label class="input-group-text" for="resy">Resolution Y</label>
            <input id="resy" type="text" class="form-control" aria-label="ws_addr" value="1080" data-tour="step: 12; title: Resolution Y; content: Adjust Y-Axis Resolution of camera here">

            <button disabled class="btn btn-primary" id="start_scan" type="button" data-tour="step: 20; title: Start live scan; content: Start live scan with this button, make sure webcam is enabled. Click again to stop pose estimation.">
                <i class="fa-solid fa-play"></i>
                <span id="start_scan_label">Start webcan and live scan</span>
            </button>
        </div>

        <div style="position: relative;" data-tour="step: 25; title: Webcam and scan stage; content: Webcam and live scan will be shown here">
            <video id="webcam" style="width: 1280px; height: 720px; position: abso" autoplay playsinline></video>
            <canvas class="output_canvas" id="output_canvas" width="1280" height="720" style="position: absolute; left: 0px; top: 0px;"></canvas>
        </div>

		<script type="module" src="custom_js"></script>

    </div>
</p>